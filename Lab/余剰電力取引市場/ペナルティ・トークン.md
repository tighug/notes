# ペナルティ・トークンの章

- 前提
  - ブロックチェーン・スマートコントラクト・トークンの説明
    - トークンとは幾つかの共通ルールに従ったスマートコントラクトである
    - スマートコントラクトでは関数毎に実行可能なアドレスを制限できる
  - 提案システムのアーキテクチャーを図示、説明
  - 提案システムのフローを図示、説明

## 提案するトークンの構成

- 提案システムでは余剰電力をトークンで表現し、ブロックチェーン上の市場で暗号通貨と引き換えに取引される。売り手は DSO から通知された出力制御時間帯に余剰電力を所有する PV 発電事業家であり、買い手は同時間帯に追加需要が創出可能な需要家である。
- 提案システムでは、約定に成功した場合には市場参加者感で暗号通貨と余剰電力トークンの交換が行われ、取引完了後には売り手のアドレスに暗号通貨が送られ、買い手のアドレスには余剰電力トークンが送られる。約定に失敗した場合には交換は行われず、売り手のアドレスにはそのまま余剰電力トークンが残る。
- 取引後に余剰電力トークンを所有する買い手は、需要創出の機会を取得し、余剰電力トークンは買い手にとってのリワードとして機能する。
- 反対に取引後に余剰電力トークンを所有する売り手は、出力抑制を行う必要があり、余剰電力トークンは売り手にとってのペナルティとして機能する。
- 従来の FT 規格では、トークン所有者が所有するトークンを自由に送信（Transfer）・消滅（Burn）可能であり、ペナルティ・トークンとして用いるには不適である。そのため、余剰電力トークンを表現するためには、所有者自身が送信・消滅の不可能な新たなトークン規格が必要である。
- また、有用なスマートコントラクトのライブラリのコレクションとして知られる OpenZeppelin では、ブロックチェーン上のアドレスに対し、所有者（Owner）や鋳造者（Minter）、消滅者（Burner）等の役割（Role）を与え、関数毎に実行可能な Role を制限可能である。これを応用し、余剰電力トークンを表現するために、売り手（Seller）と買い手（Buyer）の Role を作成し、所有者によってリワードとしてもペナルティとしても機能する「二面性」を持つトークンを作成する。

### （1） Reward Token for Buyers

> https://docs.openzeppelin.com/contracts/2.x/api/token/erc20#ERC20

- Fungible Token で現在最もよく使われている ERC20 規格を用いる。

### （2） Penalty Token for Sellers

- 所有者自身が送信・消滅の不可能な新たなトークン規格を作成する。
- IPenaltyToken.sol

| function                                                        | access restriction | description                                        |
| --------------------------------------------------------------- | ------------------ | -------------------------------------------------- |
| totalSupply()                                                   | -                  |                                                    |
| balanceOf(address account)                                      | -                  | account が所有するトークンの残高                   |
| transferFrom(address sender, address recipient, uint256 amount) | Owner              | amount 分のトークンを sender から recipient に送る |
| mint(address account, uint256 amount)                           | Owner              | amount 分のトークンを account に鋳造する           |
| burnFrom(address account, uint256 amount)                       | Owner              | amount 分のトークンを account から消滅する         |

### （3） 余剰電力トークン

※ クラス図作成中
